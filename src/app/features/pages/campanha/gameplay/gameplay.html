<div class="h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex">
  
  <!-- Loading -->
  <div *ngIf="isLoading()" class="flex-1 flex justify-center items-center">
    <i class="pi pi-spin pi-spinner text-orange-500 text-6xl"></i>
  </div>

  <div *ngIf="!isLoading() && campanha() && personagem()" class="flex-1 flex">
    
    <!-- Informações do personagem -->
    <aside class="w-80 bg-slate-900 border-r border-slate-700 flex flex-col">
      
      <!-- Header do personagem -->
      <div class="p-6 border-b border-slate-700">
        <button 
          pButton 
          icon="pi pi-arrow-left" 
          label="Sair"
          class="mb-4 w-full bg-slate-800 hover:bg-slate-700 border-none text-sm"
          (click)="voltarParaPersonagens()">
        </button>

        <h2 class="text-2xl font-bold text-white mb-2">{{ personagem()!.nome }}</h2>
        <div class="flex items-center gap-2 text-sm text-slate-400">
          <span>{{ personagem()!.raca }}</span>
          <span>•</span>
          <span>{{ personagem()!.classe }}</span>
        </div>
      </div>

      <!-- Status do personagem -->
      <div class="p-6 space-y-4 flex-1 overflow-y-auto">
        
        <!-- Nivel -->
        <div class="bg-slate-800/50 rounded-lg p-4">
          <div class="text-slate-400 text-xs mb-1">Nível</div>
          <div class="text-white text-2xl font-bold">{{ estado()?.nivel || 1 }}</div>
        </div>

        <!-- Vida -->
        <div class="bg-slate-800/50 rounded-lg p-4">
          <div class="flex justify-between items-center mb-2">
            <span class="text-slate-400 text-xs">Vida</span>
            <span class="text-white font-bold text-sm">
              {{ estado()?.vida_atual || 0 }} / {{ estado()?.vida_maxima || 0 }}
            </span>
          </div>
          <p-progressBar 
            [value]="getPorcentagemVida()" 
            [showValue]="false"
            [style]="{'height': '8px', 'background': '#1e293b'}">
          </p-progressBar>
        </div>

        <!-- Experiencia -->
        <div class="bg-slate-800/50 rounded-lg p-4">
          <div class="text-slate-400 text-xs mb-1">Experiência</div>
          <div class="text-white text-xl font-bold">{{ estado()?.experiencia || 0 }} XP</div>
        </div>

        <!-- Inventario -->
        <div class="bg-slate-800/50 rounded-lg p-4">
          <div class="text-white font-bold mb-3 flex items-center gap-2">
            <i class="pi pi-shopping-bag text-orange-400"></i>
            <span>Inventário</span>
          </div>
          
          <div *ngIf="estado()?.inventario && estado()!.inventario.length > 0" class="space-y-2">
            <div 
              *ngFor="let item of estado()!.inventario" 
              class="bg-slate-900/50 rounded px-3 py-2 text-slate-300 text-sm flex items-center gap-2">
              <i class="pi pi-box text-slate-500"></i>
              <span>{{ item }}</span>
            </div>
          </div>

          <div *ngIf="!estado()?.inventario || estado()!.inventario.length === 0" 
               class="text-center py-4">
            <i class="pi pi-inbox text-slate-600 text-3xl mb-2"></i>
            <p class="text-slate-500 text-sm">Vazio</p>
          </div>
        </div>
      </div>
    </aside>

    <!-- Chat da campanha -->
    <main class="flex-1 flex flex-col">
      <!-- Header da Campanha -->
      <header class="bg-slate-900 border-b border-slate-700 p-4">
        <h1 class="text-xl font-bold text-white flex items-center gap-2">
          <i class="pi pi-book text-orange-400"></i>
          <span>Aventura em Andamento</span>
        </h1>
      </header>
      <!-- Area do chat-->
      <div #chatContainer class="flex-1 overflow-y-auto p-6 space-y-4 scroll-smooth">
        <!-- Mensagens do chat -->
        <div *ngFor="let interacao of historico()" class="space-y-3">
          <!-- Ação do Jogador (se não for inicio) -->
          <div *ngIf="!isPrimeiraMensagem(interacao)" class="flex justify-end">
            <div class="bg-orange-600 text-white rounded-lg px-4 py-3 max-w-2xl">
              <div class="text-sm opacity-90 mb-1">Você:</div>
              <div class="font-medium">{{ interacao.acao_jogador }}</div>
            </div>
          </div>

          <!-- Resposta do LLM -->
          <div class="flex justify-start">
            <div class="bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 max-w-3xl">
              
              <!-- Narrativa -->
              <div class="text-slate-300 leading-relaxed whitespace-pre-wrap mb-4">
                {{ interacao.resposta_llm.narrativa }}
              </div>

              <!-- Evento (se houver) -->
              <div *ngIf="interacao.resposta_llm.evento && interacao.resposta_llm.evento.tipo !== 'inicio'" 
                   class="bg-slate-900/50 rounded-lg p-3 mb-3">
                <div class="flex items-center gap-2 mb-2">
                  <i class="pi pi-bolt text-yellow-400"></i>
                  <span class="text-white font-bold text-sm uppercase">Evento</span>
                </div>
                <div class="text-slate-400 text-sm">
                  Tipo: {{ interacao.resposta_llm.evento.tipo }}
                </div>
              </div>

              <!-- Próxima etapa -->
              <div *ngIf="interacao.resposta_llm.proximaEtapa" 
                   class="text-slate-500 text-sm italic mt-3">
                {{ interacao.resposta_llm.proximaEtapa }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ações sugeridas -->
      <footer class="bg-slate-900 border-t border-slate-700 p-4 space-y-4">
        <div *ngIf="ultimaResposta()?.acoesDisponiveis && ultimaResposta()!.acoesDisponiveis.length > 0">
          <div class="text-slate-400 text-sm mb-2 font-semibold">Ações Sugeridas:</div>
          <div class="flex flex-wrap gap-2">
            <button 
              *ngFor="let acao of ultimaResposta()!.acoesDisponiveis"
              pButton 
              [label]="acao"
              class="bg-slate-700 hover:bg-slate-600 border-slate-600"
              [disabled]="isEnviandoAcao()"
              (click)="enviarAcaoSugerida(acao)">
            </button>
          </div>
        </div>

        <!-- Input de ação Livre -->
        <div class="flex gap-2">
          <input 
            type="text" 
            pInputText 
            [(ngModel)]="acaoLivre"
            placeholder="Digite sua ação..."
            class="flex-1 bg-slate-800 border-slate-700 text-white"
            [disabled]="isEnviandoAcao()"
            (keyup.enter)="enviarAcaoLivre()" />
          
          <button 
            pButton 
            icon="pi pi-send" 
            label="Enviar"
            class="bg-orange-500 hover:bg-orange-600 border-none"
            [disabled]="isEnviandoAcao()"
            (click)="enviarAcaoLivre()">
          </button>
        </div>
      </footer>
    </main>

  </div>
</div>