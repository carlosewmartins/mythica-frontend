<div class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-8">
  
  <!-- Header -->
  <div class="max-w-7xl mx-auto mb-8">
    <!-- Botão Voltar -->
    <button 
      pButton 
      icon="pi pi-arrow-left" 
      label="Voltar"
      severity="secondary"
      [outlined]="true"
      class="mb-4"
      routerLink="/personagens">
    </button>

    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-4xl font-bold text-white mb-2 flex items-center gap-3">
          <i class="pi pi-book text-orange-500"></i>
          Minhas Campanhas
        </h1>
        <p class="text-slate-400">Gerencie suas aventuras e reviva momentos épicos</p>
      </div>
      <button 
        pButton 
        icon="pi pi-plus" 
        label="Nova Campanha"
        class="bg-orange-600 hover:bg-orange-700 border-none"
        routerLink="/personagens">
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="max-w-7xl mx-auto mb-6">
    <div class="flex gap-2 flex-wrap">
      <button 
        pButton 
        [label]="'Todas (' + campanhas().length + ')'"
        [outlined]="filtroAtual() !== 'todas'"
        [severity]="filtroAtual() === 'todas' ? 'primary' : 'secondary'"
        (click)="setFiltro('todas')"
        class="transition-all">
      </button>
      <button 
        pButton 
        [label]="'Ativas (' + getCountAtivas() + ')'"
        [outlined]="filtroAtual() !== 'ativa'"
        severity="success"
        (click)="setFiltro('ativa')"
        class="transition-all">
      </button>
      <button 
        pButton 
        [label]="'Pausadas (' + getCountPausadas() + ')'"
        [outlined]="filtroAtual() !== 'pausada'"
        severity="warn"
        (click)="setFiltro('pausada')"
        class="transition-all">
      </button>
      <button 
        pButton 
        [label]="'Concluídas (' + getCountConcluidas() + ')'"
        [outlined]="filtroAtual() !== 'concluida'"
        severity="info"
        (click)="setFiltro('concluida')"
        class="transition-all">
      </button>
    </div>
  </div>

  <!-- Lista de Campanhas -->
  <div *ngIf="!isLoading()" class="max-w-7xl mx-auto">
    
    <!-- Empty State -->
    <div *ngIf="campanhasFiltradas().length === 0" class="text-center py-16">
      <i class="pi pi-inbox text-slate-600 text-6xl mb-4"></i>
      <h3 class="text-2xl font-bold text-slate-400 mb-2">Nenhuma campanha encontrada</h3>
      <p class="text-slate-500 mb-6">
        {{ filtroAtual() === 'todas' ? 'Comece criando um personagem para iniciar sua jornada' : 'Não há campanhas com este status' }}
      </p>
      <button 
        *ngIf="filtroAtual() === 'todas'"
        pButton 
        icon="pi pi-user-plus" 
        label="Criar Personagem"
        class="bg-orange-600 hover:bg-orange-700 border-none"
        routerLink="/personagens/criar">
      </button>
    </div>

    <!-- Cards de Campanhas -->
    <div class="space-y-4">
      <p-card 
        *ngFor="let campanha of campanhasFiltradas()" 
        styleClass="bg-slate-800 border border-slate-700 hover:border-slate-600 transition-all">
        
        <div class="flex justify-between items-start gap-4">
          
          <!-- Info da Campanha -->
          <div class="flex-1">
            <div class="flex items-center gap-3 mb-3">
              <i class="pi pi-user text-orange-400 text-2xl"></i>
              <div>
                <h3 class="text-xl font-bold text-white">{{ getNomePersonagem(campanha) }}</h3>
                <p class="text-sm text-slate-400">
                  {{ campanha.historico.length || 0 }} interaç{{ campanha.historico.length === 1 ? 'ão' : 'ões' }}
                </p>
              </div>
            </div>

            <div class="flex items-center gap-4 text-sm text-slate-400 mb-3">
              <div class="flex items-center gap-2">
                <i class="pi pi-calendar"></i>
                <span>Última atualização: {{ getDataFormatada(campanha.atualizada_em) }}</span>
              </div>
              <div class="flex items-center gap-2">
                <i class="pi pi-chart-line"></i>
                <span>Nível {{ campanha.estado_atual.nivel || 1 }}</span>
              </div>
              <div class="flex items-center gap-2">
                <i class="pi pi-heart"></i>
                <span>{{ campanha.estado_atual.vida_atual }}/{{ campanha.estado_atual.vida_maxima }} HP</span>
              </div>
            </div>

            <!-- Status Tag -->
            <p-tag 
              [value]="campanha.status.toUpperCase()" 
              [severity]="getSeverityTag(campanha.status)"
              [icon]="'pi ' + getIconeStatus(campanha.status)">
            </p-tag>
          </div>

          <!-- Ações -->
          <div class="flex flex-col gap-2">
            <button 
              *ngIf="campanha.status === 'ativa'"
              pButton 
              icon="pi pi-play" 
              label="Continuar"
              class="bg-orange-600 hover:bg-orange-700 border-none"
              (click)="continuarCampanha(campanha)">
            </button>
            <button 
              pButton 
              icon="pi pi-book" 
              label="Ver Histórico"
              severity="secondary"
              [outlined]="true"
              (click)="verHistorico(campanha)">
            </button>
            <button 
              pButton 
              icon="pi pi-trash" 
              severity="danger"
              [outlined]="true"
              pTooltip="Excluir campanha"
              tooltipPosition="left"
              (click)="confirmarExclusao($event, campanha)">
            </button>
          </div>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Dialog de Histórico -->
  <p-dialog 
    [(visible)]="dialogHistoricoVisible"
    [modal]="true"
    [style]="{width: '90vw', maxWidth: '900px', height: '80vh'}"
    [header]="'Histórico da Campanha'"
    [draggable]="false"
    [resizable]="false">
    
    <div class="h-full flex flex-col">
      
      <!-- Info da Campanha -->
      <div *ngIf="campanhaAtual()" class="bg-slate-900/50 rounded-lg p-4 mb-4">
        <div class="flex items-center gap-3 mb-2">
          <i class="pi pi-user text-orange-400 text-xl"></i>
          <h3 class="text-lg font-bold text-white">{{ getNomePersonagem(campanhaAtual()!) }}</h3>
        </div>
        <div class="flex items-center gap-4 text-sm text-slate-400">
          <span>Nível {{ campanhaAtual()!.estado_atual.nivel }}</span>
          <span>{{ campanhaAtual()!.estado_atual.vida_atual }}/{{ campanhaAtual()!.estado_atual.vida_maxima }} HP</span>
          <span>{{ campanhaAtual()!.estado_atual.experiencia }} XP</span>
        </div>
      </div>

      <!-- Histórico -->
      <div *ngIf="!isLoadingHistorico()" class="flex-1 overflow-y-auto space-y-4 pr-2">
        <div *ngFor="let interacao of historico(); let i = index" class="space-y-3">
          
          <!-- Ação do Jogador (se não for início) -->
          <div *ngIf="!isPrimeiraMensagem(interacao)" class="flex justify-end">
            <div class="bg-orange-600 text-white rounded-lg px-4 py-3 max-w-2xl">
              <div class="text-xs opacity-90 mb-1">Você:</div>
              <div class="font-medium">{{ interacao.acao_jogador }}</div>
            </div>
          </div>

          <!-- Resposta do Sistema -->
          <div class="flex justify-start">
            <div class="bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 max-w-3xl">
              
              <!-- Narrativa -->
              <div class="text-slate-300 leading-relaxed whitespace-pre-wrap mb-3">
                {{ interacao.resposta_llm.narrativa }}
              </div>

              <!-- Evento -->
              <div *ngIf="interacao.resposta_llm.evento && interacao.resposta_llm.evento.tipo !== 'inicio'" 
                   class="bg-slate-900/50 rounded p-2 mb-2 text-xs text-slate-400">
                <i class="pi pi-bolt text-yellow-400"></i>
                Evento: {{ interacao.resposta_llm.evento.tipo }}
              </div>

              <!-- Ações Sugeridas -->
              <div *ngIf="interacao.resposta_llm?.acoesDisponiveis && interacao.resposta_llm.acoesDisponiveis.length > 0" 
                   class="flex gap-2 flex-wrap">
                <span 
                  *ngFor="let acao of interacao.resposta_llm.acoesDisponiveis"
                  class="text-xs bg-slate-700 text-slate-300 px-2 py-1 rounded">
                  {{ acao }}
                </span>
              </div>

              <!-- Timestamp -->
              <div class="text-xs text-slate-500 mt-2">
                {{ formatTimestamp(interacao.timestamp) }}
              </div>
            </div>
          </div>

          <p-divider *ngIf="i < historico().length - 1"></p-divider>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <button 
        pButton 
        label="Fechar" 
        icon="pi pi-times"
        severity="secondary"
        (click)="fecharHistorico()">
      </button>
    </ng-template>
  </p-dialog>
  <p-confirmDialog></p-confirmDialog>
</div>